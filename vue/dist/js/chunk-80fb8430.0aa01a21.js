(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-80fb8430"],{1253:function(e,t,o){"use strict";o.r(t);var c=o("c1b7");const a={class:"page-container"},n={class:"book-content"},l=["src"],r={class:"book-text"},s={class:"book-name"},b={class:"book-author"},d=["innerHTML"],i={class:"book-text"},m={class:"book-text comment-box"},O={class:"comment-content"},j={class:"comment-meta"},p={class:"dialog-footer"};function u(e,t,o,u,k,V){const h=Object(c["resolveComponent"])("el-card"),N=Object(c["resolveComponent"])("el-button"),g=Object(c["resolveComponent"])("el-input"),y=Object(c["resolveComponent"])("el-form-item"),f=Object(c["resolveComponent"])("el-form"),x=Object(c["resolveComponent"])("el-dialog");return Object(c["openBlock"])(),Object(c["createElementBlock"])("div",a,[Object(c["createVNode"])(h,{class:"book-card"},{default:Object(c["withCtx"])(()=>[t[4]||(t[4]=Object(c["createElementVNode"])("h2",{style:{padding:"10px"}},"图书详情",-1)),Object(c["createElementVNode"])("div",n,[Object(c["createElementVNode"])("img",{src:k.book.imgHref,alt:"书籍封面",class:"book-image"},null,8,l),Object(c["createElementVNode"])("div",r,[Object(c["createElementVNode"])("h3",s,Object(c["toDisplayString"])(k.book.name),1),Object(c["createElementVNode"])("p",b,Object(c["toDisplayString"])(k.book.author),1),Object(c["createElementVNode"])("p",null,[t[3]||(t[3]=Object(c["createTextVNode"])("简介：")),Object(c["createElementVNode"])("span",{innerHTML:k.book.intro},null,8,d)]),Object(c["createElementVNode"])("p",null,"出版年份："+Object(c["toDisplayString"])(new Date(k.book.publishYear).getFullYear()),1),Object(c["createElementVNode"])("p",null,"页数："+Object(c["toDisplayString"])(k.book.pages),1)])])]),_:1}),Object(c["createVNode"])(h,{class:"book-card",style:{"margin-top":"40px"}},{default:Object(c["withCtx"])(()=>[t[9]||(t[9]=Object(c["createElementVNode"])("h2",{style:{padding:"10px"}},"馆藏信息",-1)),(Object(c["openBlock"])(!0),Object(c["createElementBlock"])(c["Fragment"],null,Object(c["renderList"])(k.bookInstances,e=>(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",{key:e.barcode,class:"book-content bookinstance-borrow"},[Object(c["createElementVNode"])("div",i,[Object(c["createElementVNode"])("p",null,[t[5]||(t[5]=Object(c["createElementVNode"])("strong",null,"馆藏地点：",-1)),Object(c["createTextVNode"])(Object(c["toDisplayString"])(e.location),1)]),Object(c["createElementVNode"])("p",null,[t[6]||(t[6]=Object(c["createElementVNode"])("strong",null,"馆藏编号：",-1)),Object(c["createTextVNode"])(Object(c["toDisplayString"])(e.barcode),1)])]),1==e.status?(Object(c["openBlock"])(),Object(c["createBlock"])(N,{key:0,type:"primary",onClick:t=>V.borrowBook(e),class:"borrow-btn"},{default:Object(c["withCtx"])(()=>t[7]||(t[7]=[Object(c["createTextVNode"])("借阅")])),_:2},1032,["onClick"])):(Object(c["openBlock"])(),Object(c["createBlock"])(N,{key:1,type:"primary",onClick:t=>V.borrowBook(e),class:"borrow-btn",disabled:!0},{default:Object(c["withCtx"])(()=>t[8]||(t[8]=[Object(c["createTextVNode"])("已借出")])),_:2},1032,["onClick"]))]))),128))]),_:1}),Object(c["createVNode"])(h,{class:"book-card",style:{"margin-top":"40px",position:"relative"}},{default:Object(c["withCtx"])(()=>[t[14]||(t[14]=Object(c["createElementVNode"])("h2",{style:{padding:"10px"}},"用户评论",-1)),Object(c["createVNode"])(N,{type:"primary",onClick:V.addcomment,style:{position:"absolute",top:"10px",right:"10px"}},{default:Object(c["withCtx"])(()=>t[10]||(t[10]=[Object(c["createTextVNode"])(" 添加评论 ")])),_:1},8,["onClick"]),(Object(c["openBlock"])(!0),Object(c["createElementBlock"])(c["Fragment"],null,Object(c["renderList"])(k.comments,e=>(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",{key:e.readerId,class:"book-content"},[Object(c["createElementVNode"])("div",m,[Object(c["createElementVNode"])("div",O,[Object(c["createElementVNode"])("p",null,[t[11]||(t[11]=Object(c["createElementVNode"])("strong",null,null,-1)),Object(c["createTextVNode"])(Object(c["toDisplayString"])(e.content),1)])]),Object(c["createElementVNode"])("div",j,[Object(c["createElementVNode"])("p",null,[t[12]||(t[12]=Object(c["createElementVNode"])("strong",null,"读者ID：",-1)),Object(c["createTextVNode"])(Object(c["toDisplayString"])(e.readerId),1)]),Object(c["createElementVNode"])("p",null,[t[13]||(t[13]=Object(c["createElementVNode"])("strong",null,"评论时间：",-1)),Object(c["createTextVNode"])(Object(c["toDisplayString"])(e.time),1)])])])]))),128))]),_:1}),Object(c["createVNode"])(x,{modelValue:k.dialogVisible,"onUpdate:modelValue":t[2]||(t[2]=e=>k.dialogVisible=e),title:"新闻发布",width:"30%"},{footer:Object(c["withCtx"])(()=>[Object(c["createElementVNode"])("span",p,[Object(c["createVNode"])(N,{onClick:t[1]||(t[1]=e=>k.dialogVisible=!1)},{default:Object(c["withCtx"])(()=>t[15]||(t[15]=[Object(c["createTextVNode"])("取 消")])),_:1}),Object(c["createVNode"])(N,{type:"primary",onClick:V.pub_comment},{default:Object(c["withCtx"])(()=>t[16]||(t[16]=[Object(c["createTextVNode"])("确 定")])),_:1},8,["onClick"])])]),default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(f,{model:k.form,"label-width":"120px"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(y,{label:"发表你的看法:"},{default:Object(c["withCtx"])(()=>[Object(c["createVNode"])(g,{"model-value":"请输入你想说的话....",type:"textarea",style:{width:"80%"},modelValue:k.form.content,"onUpdate:modelValue":t[0]||(t[0]=e=>k.form.content=e),autosize:{minRows:1,maxRows:10}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}var k=o("b775"),V=o("b9cb"),h={name:"LatestBookDetail",data(){return{book:{ISBN:"",name:"",author:"",publisher:"",intro:"",imgHref:"",publishYear:"",pages:""},userId:"",bookInstances:[],comments:[],dialogVisible:!1,form:{},bookId:""}},methods:{async fetchBookDetail(e){console.log("加载书籍");try{const t=await k["a"].get("/book/"+e);t.data&&(this.book=t.data[0])}catch(t){console.error("获取图书详情失败:",t)}},async pub_comment(){try{console.log(this.form.content);await k["a"].post("/comment/pub",null,{params:{userId:this.userId,content:this.form.content,bookId:this.bookId}});V["a"].success("发表成功!!!")}catch(e){console.log(e)}this.dialogVisible=!1},async fetchBookInstances(e){try{const t=await k["a"].get("/bookinstance",{params:{search1:e}});t.data&&(this.bookInstances=t.data.records)}catch(t){console.error("获取图书馆藏实例失败:",t)}},async fetchComments(e){try{const t=await k["a"].get("/comment/abook",{params:{bookId:e}});t.data&&(this.comments=t.data.records)}catch(t){console.error("获取用户评论失败:",t)}},async addcomment(){this.dialogVisible=!0,this.form={}},async borrowBook(e){try{const t=await k["a"].post("/LendRecord/borrow",e,{params:{userId:this.userId}});t.data.success?alert(`成功借阅《${this.book.name}》`):alert("借阅失败，请稍后再试。")}catch(t){console.error("借阅图书失败:",t),alert("借阅失败，请稍后再试。")}}},mounted(){const e=this.$route.params.id;this.bookId=e;const t=sessionStorage.getItem("user"),o=JSON.parse(t);this.userId=o.id,this.fetchBookDetail(e),this.fetchBookInstances(e),this.fetchComments(e)}},N=(o("cb66"),o("9c21")),g=o.n(N);const y=g()(h,[["render",u],["__scopeId","data-v-063b89ad"]]);t["default"]=y},"23fb":function(e,t,o){},cb66:function(e,t,o){"use strict";o("23fb")}}]);
//# sourceMappingURL=chunk-80fb8430.0aa01a21.js.map